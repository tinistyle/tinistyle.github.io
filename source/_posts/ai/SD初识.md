---
title: Stable Diffusion 初识
date: 2024-02-24 02:37:21
tags:
  - AI绘画
  - SD
categories: AI
---

## 基础

扩散模型

前向扩散（Forward diffusion）:添加噪声 ,将噪声添加到训练图像中，逐渐将其转换为没有特点的噪声图像。 (一滴墨水掉进了一杯清水里，墨水在水中扩散，最终整杯水都是墨水的颜色，看不出来最开始是一杯清水。在下图中，猫就是清水，噪点就是墨水，随着扩散的进行，最后一张图片已经看不出来最开始的图片是猫了)

![img](https://tinistyle-self.oss-cn-chengdu.aliyuncs.com/books/a2a851a6e546d6301370f02b3b0707db.png)

反向/逆向扩散（Reverse diffusion）：利用噪声预测器，减少噪声。从图像中连续减去预测的噪声

![img](https://tinistyle-self.oss-cn-chengdu.aliyuncs.com/books/9620fea07cafc1e56e59457262f71f35.png)



SD的工作原理

**总流程** **VAE**编码压缩图片到**潜空间（latent space）**、条件（**文本条件、图片条件、Hypernetwork、LoRA、ControlNet**）作为输入进行调节，噪声预测器作为导航，预测噪声，将机器的注意力带到目的地，VAE解码解压缩。

> "潜空间"（Latent Space）是一个在机器学习和数据科学中经常出现的概念，特别是在生成模型如生成对抗网络（GANs）和变分自编码器（VAEs）等中。在这些上下文中，潜空间是一个高度抽象的、通常较低维度的空间，用于表示数据的一些内在特性。

想象一下家里的遥控器，它有多个按钮，每个按钮代表了一个特定的功能，比如开/关电视、调整音量、更换频道、调整画面色彩等。现在，这个遥控器就像高维数据空间，有很多维度（按钮）可以调整。 但实际上，你通常只会用到其中的几个关键按钮，比如电源键、音量键和频道键。这几个关键按钮就像是潜空间中的维度，用更少的信息（按钮）就能实现主要的操作（看电视）。 在这个比喻里，潜空间（关键按钮）是从更复杂的高维空间（所有遥控器按钮）中提取出来的，它包含了实现主要功能（看电视）所需的核心信息（开/关、音量、频道）。潜空间让你能更容易、更直观地操作复杂系统（电视），正如在机器学习中，潜空间能让我们更容易地理解和操作高维数据。

潜空间的其他应用

- 在图像处理中，潜在空间可以用于压缩图像，从而节省存储空间和计算资源。潜在空间还可以用于生成新的图像，从而帮助人们创造新的艺术作品。
- 在自然语言处理中，潜在空间可以用于可视化文本数据，从而帮助人们理解文本中隐藏的模式和趋势。潜在空间还可以用于训练机器翻译模型，从而提高翻译的准确性。
- 在推荐系统中，潜在空间可以用于发现用户之间的相似性，从而推荐用户感兴趣的商品或服务。
- 在金融领域，潜在空间可以用于预测市场趋势，从而帮助投资者做出更好的投资决策。



Stable Diffusion**是一种在潜在空间扩散（latent diffusion）的模型。**

**生成随机潜在空间矩阵**：首先，一个随机过程在篮子里加了各种水果，包括梨、苹果，还有一个桃。

**噪声预测器估计潜在矩阵的噪声**：噪声预测器检查篮子，意识到桃并不应该在这个篮子里，因为原本的规则是只应包含梨和苹果。

**然后从原始潜空间矩阵中减去估计的噪声**：根据噪声预测器的建议，你去掉了桃，现在篮子里只剩下梨和苹果。

**重复步骤 2 和 3 直至特定采样步骤**：你继续这个过程，每次都检查是否还有不应该在篮子里的水果（比如桃、葡萄等），如果有，就去掉它们。

**VAE的解码器将潜空间矩阵转换为最终图像**：最后，你用一个解码器把篮子里剩下的水果（梨和苹果）转换回一个高质量的图像。


